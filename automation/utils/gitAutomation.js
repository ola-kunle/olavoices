import { exec } from 'child_process';
import { promisify } from 'util';

const execAsync = promisify(exec);

/**
 * Git Automation
 */
export class GitAutomation {
  /**
   * Commit and push changes
   */
  async commitAndPush(blogTitle, files) {
    try {
      console.log('üì¶ Committing to Git...');

      // Change to repository root
      const repoRoot = process.cwd().replace(/\/automation$/, '');
      const gitOptions = { cwd: repoRoot };

      // Add files
      for (const file of files) {
        await execAsync(`git add "${file}"`, gitOptions);
      }

      // Create commit
      const message = `ü§ñ Auto-publish: ${blogTitle}

Generated by FREE automation system
- Content: Gemini AI
- Image: Pexels
- Cost: $0.00

Published: ${new Date().toISOString()}`;

      await execAsync(`git commit -m "${message.replace(/"/g, '\\"')}"`, gitOptions);
      console.log('‚úÖ Committed changes');

      // Push to GitHub
      await execAsync('git push origin main', gitOptions);
      console.log('‚úÖ Pushed to GitHub');
      console.log('üöÄ Netlify will deploy automatically!');

      return true;
    } catch (error) {
      console.error('‚ùå Git error:', error.message);
      return false;
    }
  }
}
